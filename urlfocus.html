<!DOCTYPE html>
<html>
<head>
<base href="https://www.weedtree.fyi">

<script src="https://cdn.counter.dev/script.js" data-id="c89e409b-c7ae-4e59-8da1-bf5116b65993" data-utcoffset="13"></script>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-8527SLLPYV"></script>
<script>
    window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-8527SLLPYV');
</script>

<title>WeedTree Strain Lineage Chart</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet">
<link rel="icon" type="image/svg+xml" xhref='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 850 850"><path fill="%2391C83E" d="M39.6 362.6C39.6 184.2 210.3 39.6 420.9 39.6c210.5 0 381.2 144.6 381.2 323 0 178.4-170.7 323-381.2 323-210.6 0-381.3-144.6-381.3-323z"/><path fill="%236FAC43" d="M503.2 266c0-18.6 17.8-33.7 39.7-33.7 22 0 39.7 15.1 39.7 33.7 0 18.6-17.8 33.7-39.7 33.7-22 0-39.7-15.1-39.7-33.7zm-244.2 0c0-18.6 17.8-33.7 39.7-33.7 21.9 0 39.7 15.1 39.7 33.7 0 18.6-17.8 33.7-39.7 33.7-21.9 0-39.7-15.1-39.7-33.7z"/><path fill="none" stroke="%23444" stroke-width="79.2" stroke-linejoin="round" stroke-miterlimit="8" d="M503.2 266c0-18.6 17.8-33.7 39.7-33.7 22 0 39.7 15.1 39.7 33.7 0 18.6-17.8 33.7-39.7 33.7-22 0-39.7-15.1-39.7-33.7zm-244.2 0c0-18.6 17.8-33.7 39.7-33.7 21.9 0 39.7 15.1 39.7 33.7 0 18.6-17.8 33.7-39.7 33.7-21.9 0-39.7-15.1-39.7-33.7zm-44.8 237.5c137.8 80.2 275.3 80.2 412.7 0M39.6 362.6C39.6 184.2 210.3 39.6 420.9 39.6c210.5 0 381.2 144.6 381.2 323 0 178.4-170.7 323-381.2 323-210.6 0-381.3-144.6-381.3-323z"/></svg>' />

<style>
body,html{font-family:'Poppins',Arial,sans-serif;background-color:#fff;margin:0;padding:0;font-size:14px;height:100%;overflow:hidden}.header-ribbon{background-color:#434343;color:#fff;padding:10px;display:flex;justify-content:space-between;align-items:center}.header-ribbon h1{margin:0;font-size:1.8em;color:#fff;margin-left:6px}.subhead{font-size:.4em;font-weight:400;margin-left:3px}.container{height:calc(100vh - 50px);display:flex;flex-direction:column}.chart-container{flex-grow:1;width:100%;overflow:hidden}#lineageChart{width:100%;height:100%}.header-buttons{display:flex;gap:10px;align-items:center}.btn{background-color:transparent;color:#fff;padding:5px 15px;border:2px solid #fff;border-radius:18px;cursor:pointer;font-size:0.9em;font-family:'Poppins',Arial,sans-serif;transition:all .3s ease;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}.btn:hover{background-color:rgba(255,255,255,.1)}.node text{font-size:16px;fill:black;text-anchor:start;dominant-baseline:middle;font-family:'Roboto',Arial,sans-serif;font-weight:700}.node text.product{font-size:10px;font-weight:normal;}.node.dimmed rect{opacity:.15}.node.dimmed text{opacity:.15}.node.dimmed use{opacity:.15}.link.dimmed{opacity:.15}.node.highlighted rect{stroke:#f0f;stroke-width:3px}.link.highlighted{stroke:#f0f!important;stroke-width:3px}.node.clicked rect{stroke:#f0f;stroke-width:8px}.popup{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:white;padding:20px;border-radius:10px;max-width:80%;max-height:80%;overflow-y:auto;z-index:1000;display:none;}.popup-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.5);z-index:999;display:none}#loading-message{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background-color:rgba(255,255,255,0.8);padding:20px;border-radius:10px;z-index:1001;display:none}#strainSearch{background-color:transparent;color:#fff;padding:5px 15px;border:2px solid #fff;border-radius:18px;font-size:.9em;font-family:'Poppins',Arial,sans-serif;transition:all .3s ease;width:180px}#strainSearch::placeholder{color:rgba(255,255,255,0.7)}#strainSearch:focus{outline:none;background-color:rgba(255,255,255,0.1)}#strainDropdown{position:absolute;background-color:#fff;border:1px solid #ccc;max-height:400px;overflow-y:auto;display:none;z-index:1000;width:210px;box-shadow:1 4px 8px rgba(0,0,0,0.1);border-radius:0 0 4px 4px}#strainDropdown div{padding:5px 10px;cursor:pointer;transition:background-color 0.2s;color:#434343;font-size:8pt;line-height:1.2}#strainDropdown div:hover{background-color:#f0f0f0}.search-container{position:relative}.node.highlighted-search .highlight-arrow{fill:red}#centerLine {position: fixed;top: 0;left: 0;width: 100%;height: 100%;pointer-events: none;}.fullscreen-button-container {display: flex;flex-direction: column;gap: 5px;position: absolute;top: 70px;right: 10px;z-index: 997;}.zoom-button-container {display: flex;width: 100%;gap: 5px;}.fullscreen-button-container button {width: 100%;padding: 3px 5px;border: 2px solid #cccccc;border-radius: 0;cursor: pointer;font-size: 0.3em;font-family: 'Poppins', Arial, sans-serif;transition: all 0.3s ease;color: #cccccc;background-color: white;}.node{transition: transform 0.0s ease;}.strain-list {column-width: 228px;column-gap: 5px;padding: 10px;max-height: 96%;overflow-x: auto;white-space: nowrap;}.strain-item {display: flex;align-items: center;margin-bottom: 0px;break-inside: avoid-column;}.strain-checkbox {appearance: none;-webkit-appearance: none;width: 16px;height: 16px;border: 2px solid #434343;border-radius: 50%;margin-right: 5px;cursor: pointer;position: relative;}.strain-checkbox:checked::after {content: '';position: absolute;top: 50%;left: 50%;transform: translate(-50%, -50%);width: 10px;height: 10px;background-color:#434343;border-radius:50%;}.strain-checkbox:hover {background-color: #f0f0f0;}.strain-label {font-size: 8pt;cursor: pointer;}#popup1 {padding: 0;}#popup2, #popup3 {padding: 20px;}.node use {z-index: 1000; pointer-events: none;} .node text {z-index: 999;}#zoomInButton, #zoomOutButton {flex: 1;padding: 0px 5px;font-size: 16px;font-weight: bold;}#zoomInButton {border-right: 2px solid #cccccc; border-top-right-radius: 0;border-bottom-right-radius: 0;}#zoomOutButton {border-left: 2px solid #cccccc; border-top-left-radius: 0;border-bottom-left-radius: 0;}.close-button {position: absolute;top: 10px;right: 10px;width: 30px;height: 30px;border:none;background:#434343;color:white;border-radius:50%;font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:background-color 0.3s;}.close-button:hover {background-color:#666;}.pct-pill {fill: #000;stroke: #000;stroke-width: 0px;}.pct-pill-text {fill: #fff;font-size: 9px;  font-weight: 700;pointer-events: none;}
</style> 

<script src="https://d3js.org/d3.v6.min.js"></script>

</head>

    <body>
<div class="header-ribbon">
    <h1>WeedTree.fyi Strain Lineage Chart <span class="subhead">Work in progress, errors probable</span></h1>
    <div class="header-buttons">
        <div class="search-container">
            <input type="text" id="strainSearch" placeholder="Locate strain">
            <div id="strainDropdown"></div>
        </div>
        
        <button id="btn3" class="btn">About</button>
    </div>
</div>
<div class="fullscreen-button-container">
    <button id="fullscreenToggle" class="btn">Toggle Full Screen</button>
    <div class="zoom-button-container">
        <button id="zoomInButton" class="btn">+</button>
        <button id="zoomOutButton" class="btn">-</button>
    </div>
    <button id="deselectButton" class="btn">De-select</button>
</div>
<div class="container">
    <div class="chart-container">
        <div id="lineageChart"></div>
    </div>
</div>
<div class="popup-overlay"></div>
<div id="popup1" class="popup">
    <div id="strainList" class="strain-list"></div>
</div>
<div id="popup2" class="popup"><h5>Record and rate your strains - coming soon</h5></div>
<div id="popup3" class="popup">
    <button class="close-button">Ã—</button>
    
<h2>Welcome to Weedtree, the family tree of cannabis strains</h2>
    
<p>I've always wondered how strain lineage correlated with the strains I personally prefer. Indica vs Sativa, Kush vs Afghani, Skunk vs Thai. I haven't been able to find much of a lineage chart anywhere online so decided to create one myself. </p>
    
<p>I don't claim that the chart is completely accurate, it is based on what I could interpret from the multitude of, often contradictory, strain database sites internationally, and I've made some simplifications around phenotype/cultivar/clone/variant pedigree. Obviously it is far from complete.</p>
    
<p></br>Push F11 to toggle full screen.
</br>Use the mouse or controls to zoom in and out.
</br> Nodes are draggable within their column (press shift / long press on mobile).
</br> Click on a strain to isolate its lineage.</p>
    
<p>Isolation mode shows rough percentage of contribution based on lineage, but will be inaccurate as it does not account for the realities and nuances of selective breeding.</p>

<p>Sorry it's a bit hard to use on mobile, best on a large screen. Strain search isn't working on mobile at the moment either.</p>


    
</div>
<div id="loading-message">Loading strain data, please wait...</div>
<div id="centerLine"></div>
<svg id="nzIconTemplate" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" style="display: none;">
  <symbol id="nzIcon">
    <circle cx="14" cy="14" r="12.5" fill="white" stroke="black" stroke-width="3"/>
    <line x1="7" y1="9" x2="7" y2="19" stroke="black" stroke-width="3" stroke-linecap="round"/>
    <line x1="7" y1="9" x2="13" y2="19" stroke="black" stroke-width="3" stroke-linecap="round"/>
    <line x1="13" y1="9" x2="13" y2="19" stroke="black" stroke-width="3" stroke-linecap="round"/>
    <line x1="16" y1="9" x2="20.5" y2="9" stroke="black" stroke-width="3" stroke-linecap="round"/>
    <line x1="16" y1="19" x2="21.5" y2="19" stroke="black" stroke-width="3" stroke-linecap="round"/>
    <line x1="21.5" y1="9" x2="16" y2="19" stroke="black" stroke-width="3" stroke-linecap="round"/>
  </symbol>
</svg>

        
<script>
let strainData = [], attributes = [], nodes = [], svg, g, zoom, focusedNode = null, lineWidth = 2;

// --- Shared node layout constants ---
const nodePillHeight = 30;
const nodeStrokeWidth = 3;
const nodeStrokeColor = '#000';
const nodeTextYOffset = 1;

// --- Helper functions ---
const showError = message => {
    document.getElementById('loading-message').style.display = 'none';
    alert(message);
};

const formatPercentage = p => p < 5 ? '<5%' : `${p.toFixed(0)}%`;

const getColorByDominance = dominance => {
    switch(dominance.toLowerCase()) {
        case 'sativa dominant': return '#ffea8a';
        case 'indica dominant': return '#9be7f5';
        case 'ruderalis dominant': return '#d9d2e9';    
        case 'balanced hybrid': return '#bee8a6';
        case 'unknown': return '#d1e6cb';
        default: return '#EAEAEA';
    }
};

const darkenColor = (color, amount) => d3.color(color).darker(amount / 10).toString();
const blendToWhite = (color, amount) => d3.interpolateRgb(d3.color(color), d3.color('#ffffff'))(amount);

// --- Fetch CSV data ---
fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vSoTjN6psMidKhKOaAxqcZQQ_ArKkUTuRgn65c3ncNqjdLASER0J-Z3WYxFNuhFX_gDVoyHyH1PcCZy/pub?output=csv&gid=1070299978')
    .then(res => res.ok ? res.text() : Promise.reject('Network response was not ok'))
    .then(csvText => {
        const rows = csvText.trim().split('\n').map(r => r.split(',').map(c => c.trim()));
        if (rows.length < 2) return showError('Not enough data in the spreadsheet.');
        attributes = rows[0];
        strainData = rows.slice(1).map(r => {
            let obj = {};
            attributes.forEach((attr, i) => obj[attr] = r[i] || '');
            return obj;
        }).filter(obj => Object.values(obj).some(v => v !== ''));

        document.getElementById('loading-message').style.display = 'none';

        createLineageChart();
        setupStrainSearch();
        applyUrlFocus();
    })
    .catch(err => showError('Error fetching data: ' + err));

// --- Node calculations ---
function calculateUpwardChildTotals(startNode, nodes) {
    const contributions = new Map();
    function walk(node, amount) {
        contributions.set(node.id, (contributions.get(node.id) || 0) + amount);
        let parents = [];
        if (node.parents) parents = node.parents.map(pid => nodes.find(n => n.id === pid)).filter(Boolean);
        if (node.variant) { const base = nodes.find(n => n.name === node.variant); if (base) parents.push(base); }
        if (!parents.length) return;
        const split = amount / parents.length;
        parents.forEach(p => walk(p, split));
    }
    walk(startNode, 100);
    return contributions;
}

function calculateDownwardDescendantTotals(startNode, nodes) {
    const contributions = new Map();
    function walk(node, amount) {
        if (node.id !== startNode.id) contributions.set(node.id, (contributions.get(node.id) || 0) + amount);
        const children = nodes.filter(n => (n.parents && n.parents.includes(node.id)) || n.variant === node.name);
        children.forEach(child => {
            let parentCount = (child.parents ? child.parents.length : 0) + (child.variant ? 1 : 0);
            if (parentCount) walk(child, amount / parentCount);
        });
    }
    walk(startNode, 100);
    return contributions;
}

// --- Populate sidebar strain list ---
function populateStrainList() {
    const strainList = document.getElementById('strainList');
    strainList.innerHTML = '';
    const sorted = nodes.filter(n => !n.name.toLowerCase().includes('unknown')).sort((a,b)=>a.name.localeCompare(b.name));
    sorted.forEach(n => {
        const div = document.createElement('div'); div.className='strain-item';
        const cb = document.createElement('input'); cb.type='checkbox'; cb.id=`strain-${n.id}`; cb.className='strain-checkbox';
        const label = document.createElement('label'); label.htmlFor=cb.id; label.className='strain-label';
        label.textContent = n.name + (n.product ? ` (${n.product})` : '');
        div.appendChild(cb); div.appendChild(label); strainList.appendChild(div);
    });
}

// --- Lineage chart ---
function createLineageChart() {
    const container = document.querySelector('.chart-container');
    const width = container.clientWidth, height = container.clientHeight;
    d3.select('#lineageChart').selectAll('*').remove();
    svg = d3.select('#lineageChart').append('svg').attr('width', width).attr('height', height);
    g = svg.append('g');
    zoom = d3.zoom().scaleExtent([0.1,4]).on('zoom', e => g.attr('transform', e.transform));
    svg.call(zoom);

    nodes = strainData.map(s => ({
        id: s.Strain,
        name: s.Strain,
        displayName: s.Strain,
        dominance: s.Dominance,
        parents: [s.Parent1,s.Parent2,s.Parent3,s.Parent4].filter(Boolean),
        generation: 0,
        special: s.Special,
        product: s.Product,
        variant: s.Variant,
        alsoKnownAs: s['Also Known As']
    }));

    const hasChildren = new Set(nodes.flatMap(n => n.parents));
    nodes = nodes.filter(n => hasChildren.has(n.name) || n.parents.length > 0 || n.special || n.variant);
    nodes.forEach(n => { if(n.name.toLowerCase().includes('unknown')) n.displayName = n.name.replace(/\d+/g,''); });
    nodes.sort((a,b)=>a.product&&!b.product?1:!a.product&&b.product?-1:0);

    const links = [];
    nodes.forEach(n => {
        if(n.variant){ const p=nodes.find(nd=>nd.name===n.variant); if(p) links.push({source:p.id,target:n.id}); }
        else n.parents.forEach(p=>{ if(p && nodes.some(nd=>nd.id===p)) links.push({source:p,target:n.id}); });
    });

    // Assign generations
    let changed=true;
    while(changed){ changed=false;
        nodes.forEach(n=>{
            if(n.name.toLowerCase().includes('unknown lineages') && n.generation!==2){n.generation=2; changed=true;}
            else if(n.special?.toLowerCase()==='origin' && n.generation!==0){n.generation=0; changed=true;}
            else if(n.special?.toLowerCase()==='landrace' && n.generation!==1){n.generation=1; changed=true;}
            else if(n.variant){ const p=nodes.find(nd=>nd.name===n.variant); if(p && n.generation!==p.generation){n.generation=p.generation; changed=true;} }
            else { const pg=n.parents.map(pid=>{const p=nodes.find(nd=>nd.id===pid); return p?p.generation:-1;}).filter(g=>g!==-1);
                if(pg.length){ const maxG=Math.max(...pg); if(n.generation!==maxG+1){n.generation=maxG+1; changed=true; } } }
        });
    }

    const maxGen = Math.max(...nodes.map(n=>n.generation));
    const standardPillWidth = Math.max(...nodes.map(d=>d.displayName.length*7),150);
    const columnWidth = Math.max(width/(maxGen+1),standardPillWidth*1.6);
    const pillHeight = nodePillHeight;

    for(let gen=0;gen<=maxGen+1;gen++){
        let genNodes = nodes.filter(n=>(n.generation===gen) || (gen===1 && n.special?.toLowerCase()==='landrace'));
        let yOffset=0; const totalH = genNodes.length*(pillHeight+10); const startY=(height-totalH)/2;
        genNodes.forEach((n,i)=>{ n.x=gen*columnWidth; if(gen!==0 || n.y===undefined) n.y=startY+yOffset; yOffset+=pillHeight+16; });
    }

    // Links
    g.append('g').selectAll('path').data(links).join('path')
        .attr('class','link')
        .attr('stroke',d=>darkenColor(getColorByDominance(nodes.find(n=>n.id===d.source).dominance),2))
        .attr('stroke-width',lineWidth+1)
        .attr('fill','none')
        .attr('d',d=>{ const s=nodes.find(n=>n.id===d.source); const t=nodes.find(n=>n.id===d.target);
            const sW=s.variant?standardPillWidth*0.85:standardPillWidth; const tW=t.variant?standardPillWidth*0.85:standardPillWidth;
            const mid=(s.x+sW/2 + t.x-tW/2)/2; return `M${s.x+sW/2},${s.y} C${mid},${s.y} ${mid},${t.y} ${t.x-tW/2},${t.y}`; });

    let dragging=false;
    const nodeSel = g.append('g').selectAll('g').data(nodes).join('g')
        .attr('class','node')
        .attr('transform',d=>`translate(${d.x},${d.y})`)
        .each(d=>{if(d.product)d3.select(this).raise();})
        .on('click',highlightLineage)
        .on('mouseover',function(event,d){ if(dragging) return; d3.select(this).raise().transition().attr('transform',`translate(${d.x},${d.y}) scale(1.7,1.7)`); })
        .on('mouseout',function(event,d){ if(dragging) return; d3.select(this).transition().attr('transform',`translate(${d.x},${d.y}) scale(1)`); });

    nodeSel.call(d3.drag()
        .on('start',(event,d)=>{ if(event.sourceEvent.type.startsWith('touch')){ d.longPressTimer=setTimeout(()=>startDrag(event,d,this),400); } else { if(!event.sourceEvent.shiftKey) return; startDrag(event,d,this); } })
        .on('drag',(event,d)=>{ if(!d.dragging) return; dragNode(event,d,this); })
        .on('end',(event,d)=>{ if(d.longPressTimer){clearTimeout(d.longPressTimer); d.longPressTimer=null;} if(!d.dragging)return; d.dragging=false; dragging=false; })
    );

    // Node rects and text
    nodeSel.append('rect')
        .attr('rx',pillHeight/2).attr('ry',pillHeight/2)
        .attr('width',d=>d.variant?standardPillWidth*0.85:standardPillWidth)
        .attr('height',pillHeight)
        .attr('fill',d=>d.variant?blendToWhite(getColorByDominance(nodes.find(n=>n.name===d.variant).dominance),0.5):getColorByDominance(d.dominance))
        .attr('x',d=>d.variant?-(standardPillWidth*0.85)/2:-standardPillWidth/2)
        .attr('y',-pillHeight/2)
        .attr('stroke',d=>d.product?'black':getColorByDominance(d.dominance))
        .attr('stroke-width',3);

    nodeSel.append('text').attr('class','strain-name').text(d=>d.displayName)
        .attr('x',d=>d.variant?-(standardPillWidth*0.85)/2+12:-standardPillWidth/2+12)
        .attr('y',1).attr('dominant-baseline','middle').attr('fill','black')
        .style('font-size','15px').style('font-family','Roboto, Arial, sans-serif').style('font-weight','bold');

    populateStrainList();
}

// --- Drag helpers ---
function startDrag(event,d,nodeEl){ dragging=true; d.dragging=true; d3.select(nodeEl).raise(); d.variantOffsets=nodes.filter(n=>n.variant===d.name).map(v=>({id:v.id,offsetY:v.y-d.y})); }
function dragNode(event,d,nodeEl){ d.y=event.y; d3.select(nodeEl).attr('transform',`translate(${d.x},${d.y})`);
    if(d.variantOffsets)d.variantOffsets.forEach(vo=>{ const v=nodes.find(n=>n.id===vo.id); v.y=d.y+vo.offsetY; g.selectAll('.node').filter(n=>n.id===v.id).attr('transform',`translate(${v.x},${v.y})`); });
    g.selectAll('.link').attr('d',l=>{ const s=nodes.find(n=>n.id===l.source); const t=nodes.find(n=>n.id===l.target);
        const sW=s.variant?150*0.85:150; const tW=t.variant?150*0.85:150; const mid=(s.x+sW/2+t.x-tW/2)/2;
        return `M${s.x+sW/2},${s.y} C${mid},${s.y} ${mid},${t.y} ${t.x-tW/2},${t.y}`; });
}

// --- Strain search ---
function setupStrainSearch(){
    const input=document.getElementById('strainSearch'); const dropdown=document.getElementById('strainDropdown'); let highlightedNode=null;
    input.addEventListener('input',function(){ const text=this.value.toLowerCase(); if(!text){dropdown.style.display='none'; return;} const matches=nodes.filter(n=>!n.name.toLowerCase().includes('unknown')&&(n.name.toLowerCase().includes(text)||(n.product&&n.product.toLowerCase().includes(text))||(n.alsoKnownAs&&n.alsoKnownAs.toLowerCase().includes(text)))); dropdown.innerHTML=''; matches.sort((a,b)=>a.name.localeCompare(b.name)).forEach(s=>{ const div=document.createElement('div'); div.innerHTML=s.name+(s.product?`<br>(${s.product})`:'')+(s.alsoKnownAs?` [${s.alsoKnownAs}]`:''); div.addEventListener('click',()=>{ highlightStrain(s); dropdown.style.display='none'; input.value=''; }); dropdown.appendChild(div); }); dropdown.style.display=matches.length?'block':'none'; });
    document.addEventListener('click',e=>{ if(!input.contains(e.target)&&!dropdown.contains(e.target)) dropdown.style.display='none'; });

    function highlightStrain(strain){ if(highlightedNode){ d3.select(highlightedNode).select('.highlight-arrow')?.remove(); highlightedNode=null; }
        const node=g.selectAll('.node').filter(d=>d.id===strain.id);
        const arrow=node.append('path').attr('d','M-70,-6 L-39,0 L-70,6 Z').attr('class','highlight-arrow').attr('fill','red').attr('transform','translate(0,0) scale(3)');
        arrow.on('mouseover',()=>{ d3.select(arrow.node()).remove(); highlightedNode=null; }).on('click',e=>e.stopPropagation());
        highlightedNode=node.node();
        zoomToNode(strain);
    }
    function zoomToNode(strain){ const t=d3.zoomTransform(svg.node()); const scale=2; const x=-strain.x*scale+svg.attr('width')/2; const y=-strain.y*scale+svg.attr('height')/2; svg.transition().duration(750).call(d3.zoom().transform,d3.zoomIdentity.translate(x,y).scale(scale)); }
}

// --- URL focus ---
function applyUrlFocus(){
    const params=new URLSearchParams(window.location.search);
    const focusParam=params.get('focus'); if(!focusParam) return;
    const nodeToFocus=nodes.find(n=>n.name.toLowerCase()===focusParam.replace(/_/g,' ').toLowerCase()); if(!nodeToFocus) return;
    highlightLineage(null,nodeToFocus);
}

</script>

</body>
</html>

