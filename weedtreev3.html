<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<base href="https://imperfiktillusion.github.io/weedtree/">
<title>WeedTree.fyi Strain Lineage Chart</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&family=Roboto+Condensed:wght@400;700&display=swap" rel="stylesheet">
<link rel="icon" type="image/svg+xml" href='data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 850 850"><path fill="%2391C83E" d="M39.6 362.6C39.6 184.2 210.3 39.6 420.9 39.6c210.5 0 381.2 144.6 381.2 323 0 178.4-170.7 323-381.2 323-210.6 0-381.3-144.6-381.3-323z"/></svg>' />
<style>
/* --- keep all your original CSS here --- */
</style>
<script src="https://d3js.org/d3.v6.min.js"></script>
</head>
<body>
<div class="header-ribbon">
    <h1>WeedTree.fyi Strain Lineage Chart <span class="subhead">Work in progress, errors probable</span></h1>
    <div class="header-buttons">
        <div class="search-container">
            <input type="text" id="strainSearch" placeholder="Locate strain">
            <div id="strainDropdown"></div>
        </div>
        <button id="btn3" class="btn">About</button>
    </div>
</div>

<div class="fullscreen-button-container">
    <button id="fullscreenToggle" class="btn">Toggle Full Screen</button>
    <div class="zoom-button-container">
        <button id="zoomInButton" class="btn">+</button>
        <button id="zoomOutButton" class="btn">-</button>
    </div>
    <button id="deselectButton" class="btn">De-select</button>
</div>

<div class="container">
    <div class="chart-container">
        <div id="lineageChart"></div>
    </div>
</div>

<div class="popup-overlay"></div>
<div id="popup1" class="popup">
    <div id="strainList" class="strain-list"></div>
</div>
<div id="popup2" class="popup"><h5>Record and rate your strains - coming soon</h5></div>
<div id="popup3" class="popup">
    <button class="close-button">Ã—</button>
    <h2>Welcome to Weedtree, the family tree of cannabis</h2>
    <p>I've always wondered how strain lineage correlated with the strains I personally prefer...</p>
</div>
<div id="loading-message">Loading strain data, please wait...</div>
<div id="centerLine"></div>

<script>
// --- Keep your original CSV fetch and chart creation code exactly as it was ---
// Only modify the strain search for mobile support

function setupStrainSearch(nodes) {
    const searchInput = document.getElementById('strainSearch');
    const dropdown = document.getElementById('strainDropdown');
    let highlightedNode = null;

    const showResults = (text) => {
        dropdown.innerHTML = '';
        const results = nodes.filter(n => n.name.toLowerCase().includes(text.toLowerCase()));
        results.forEach(node => {
            const div = document.createElement('div');
            div.innerHTML = node.name;
            div.addEventListener('click', () => { highlightNode(node); dropdown.style.display='none'; searchInput.value=''; });
            div.addEventListener('touchstart', () => { highlightNode(node); dropdown.style.display='none'; searchInput.value=''; });
            dropdown.appendChild(div);
        });
        dropdown.style.display = results.length ? 'block' : 'none';
    };

    searchInput.addEventListener('input', e => showResults(e.target.value));
    document.addEventListener('click', e => { if (!searchInput.contains(e.target) && !dropdown.contains(e.target)) dropdown.style.display='none'; });
    document.addEventListener('touchstart', e => { if (!searchInput.contains(e.target) && !dropdown.contains(e.target)) dropdown.style.display='none'; });

    function highlightNode(node) {
        if(highlightedNode) { d3.select(highlightedNode).select('.highlight-arrow').remove(); highlightedNode=null; }
        const sel = d3.selectAll('.node').filter(d => d.id === node.id);
        sel.append('path').attr('d','M-70,-6 L-39,0 L-70,6 Z').attr('class','highlight-arrow').attr('fill','red');
        highlightedNode = sel.node();
        // zoom function if you already have one
        if(typeof zoomToNode === 'function') zoomToNode(node);
    }
}

// --- Call this inside your CSV fetch success callback ---
// setupStrainSearch(nodes);

</script>
</body>
</html>
